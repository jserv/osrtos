---
title: Apache NuttX NSH Task Demo
summary: A demonstration project for creating and running tasks within the NuttX Shell
  (NSH) environment. It provides a corrected implementation for task creation on Apache
  NuttX, specifically targeting ARM64 platforms via QEMU emulation.
slug: apache-nuttx-nsh-task-demo
codeUrl: https://github.com/lupyuen/nshtask
star: 0
lastUpdated: '2023-01-28'
rtos: nuttx
topics:
- nsh
- nuttx
isShow: false
createdAt: '2026-01-04'
updatedAt: '2026-01-04'
---

## Overview

The `nshtask` project is a specialized demonstration for the Apache NuttX RTOS, designed to show the correct way to implement and register a task within the NuttX Shell (NSH). This repository serves as a practical reference for developers who need to bridge the gap between standard application code and the NuttX task management system.

One of the unique aspects of this project is its role as a corrective resource. The author created this repository to address and fix incorrect code patterns often generated by AI tools regarding NuttX task creation. By providing a verified, working example, it ensures that developers follow the proper NuttX conventions for task entry points and shell integration.

## Technical Implementation

The project is structured to be integrated directly into the NuttX `apps` directory as a submodule. It follows the standard NuttX application structure, utilizing several key configuration files:

- **Kconfig**: Defines the configuration menu for the demo, allowing users to set the task priority (defaulting to 100) and stack size (defaulting to 16 KB) through the `menuconfig` interface.
- **Makefile & Make.defs**: These files integrate the project into the NuttX build system, defining the program name as `nshtask` and linking the source files.
- **nshtask.c**: The core source file containing the application logic and the entry point required by the shell.

## Target Platform and Emulation

While NuttX is highly portable, this demo specifically targets the **ARM64 (AArch64)** architecture. It is configured to run on the `qemu-armv8a:nsh` board profile, which emulates a Cortex-A53 machine. This allows developers to test task behavior, shell interaction, and system scheduling without requiring physical hardware. The project utilizes the `aarch64-none-elf` toolchain for cross-compilation.

## Integration and Usage

To use the demo, it must be placed within the `apps/examples` folder of a NuttX installation. Once configured via `make menuconfig`, the "NSH Task Demo" appears under the Examples menu. 

### Key Features
- **Shell Integration**: Once enabled, the task can be invoked directly from the NSH prompt by typing `nshtask`.
- **Boot Execution**: The project provides instructions on how to set `nshtask_main` as the application entry point in the RTOS features configuration, allowing the task to start automatically upon system boot.
- **Corrected Task Logic**: Unlike generic POSIX examples, this project demonstrates the specific header requirements and function signatures needed for stable operation within the NuttX environment.

## Getting Started

The project is designed to be used alongside the main Apache NuttX and Apps repositories. After cloning the dependencies and adding `nshtask` as a submodule, users configure the build for the QEMU ARMv8a target. The demo highlights the importance of using the `tools/configure.sh` script and the `menuconfig` tool to properly register new tasks in the system image. Once the build is complete, the resulting kernel can be booted in QEMU to interact with the task via the serial console.
