---
title: Zephyr CVE-2021-3625 Exploit Examples
summary: A collection of proof-of-concept exploits for CVE-2021-3625, a critical buffer
  overflow vulnerability in the Zephyr RTOS USB stack. These scripts demonstrate memory
  readout and DFU overflow attacks against Zephyr-based USB devices and MCUBoot builds
  up to version 2.5.0.
slug: zephyr-cve-2021-3625-exploit-examples
codeUrl: https://github.com/szymonh/zephyr_cve-2021-3625
star: 7
lastUpdated: '2021-10-07'
rtos: zephyr
libraries:
- mcuboot
topics:
- security
- vulnerability
- zephyr
isShow: false
createdAt: '2026-01-04'
updatedAt: '2026-01-04'
---

## Understanding CVE-2021-3625

CVE-2021-3625 represents a significant security vulnerability in the Zephyr RTOS USB device stack, affecting all versions up to and including 2.5.0. This repository provides a series of Python-based proof-of-concept (PoC) scripts that demonstrate how an attacker can exploit a buffer overflow to read out up to 65kB of microcontroller memory. Depending on the device's function, this leakage can expose highly sensitive data, including encryption keys, device credentials, or internal firmware structures.

## Vulnerability Mechanism

The issue is rooted in how the USB stack handles specific control transfer requests. When a host issues a crafted USB control transfer with an IN direction (reading from the device to the host) but specifies a request typically associated with a write—such as `SET_ADDRESS` (0x05)—the stack fails to update the response length. 

Because the `wLength` field is controlled by the user (the host), an attacker can set it to an arbitrary two-byte value, such as `0xFFFF`. Since the internal buffer size is significantly smaller than 65,535 bytes, the stack proceeds to read past the buffer boundary, transmitting the contents of the microcontroller's memory back to the host.

## Scope of Impact

The vulnerability is not limited to the application layer. It also affects:
- **Zephyr USB Device Stack**: The core implementation used across various Zephyr-based projects.
- **MCUBoot**: Builds of the MCUBoot bootloader that have the Zephyr USB device stack enabled are equally vulnerable.
- **DFU Class**: Beyond simple memory readout, the Device Firmware Upgrade (DFU) class can be exploited to achieve a buffer overflow write, potentially leading to code execution or persistent device compromise.

## Proof-of-Concept Scripts

The repository includes several Python scripts using `libusb` (via `pyusb`) to trigger the vulnerability across different USB classes and requests:

- `set_address.py`: Demonstrates the core memory readout via the `SET_ADDRESS` request.
- `cdc_set_line_coding.py` and `cdc_set_control_line_state.py`: Show how CDC ACM (Communication Device Class) handlers can be used to leak memory.
- `dfu_overflow.py`: Specifically targets the DFU class to trigger a crash via buffer overflow.

### Example: DFU Overflow Trigger

The following snippet from `dfu_overflow.py` illustrates how the script switches the device to DFU mode and then issues a large `DFU_DNLOAD` request to trigger the overflow:

```python
# Trigger DFU class handler overflow - bypass len check by use of direction to host
try:
    usbdev.ctrl_transfer(bmRequestType, DFU_DNLOAD, wValue, wIndex, length)
except usb.core.USBTimeoutError:
    print('Device is now crashed due to triggered buffer overflow')
```

## Technical Recommendations

For researchers attempting to reproduce these results, it is recommended to use a custom build of `libusb`. By default, many `libusb` distributions limit the control buffer length to 4096 bytes. To successfully read the full 65kB allowed by the vulnerability, the `MAX_CTRL_BUFFER_LENGTH` in `libusb/os/linux_usbfs.h` should be increased to `0xFFFF`.

Developers using Zephyr should ensure their projects are updated to a version newer than 2.5.0 or apply the official security patches referenced in the Zephyr Project security advisory GHSA-c3gr-hgvr-f363.
