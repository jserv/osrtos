---
title: ESP32 SPIFFS Image Generation Example
summary: This project provides a practical example of integrating the SPIFFS file
  system into an ESP32 application using the ESP-IDF framework. It features automated
  workflows for generating binary images from local data folders and flashing them
  to specific partitions on the ESP32.
codeUrl: https://github.com/Shaopus/esp32_spiffsgen
isShow: false
rtos: freertos
libraries:
- spiffs
topics:
- esp32
- mkspiffs
- spiffs
star: 1
lastUpdated: '2019-11-29'
createdAt: '2025-12-27'
updatedAt: '2025-12-27'
---

Integrating a file system into an embedded project is a common requirement for storing configuration files, web assets, or logs. For ESP32 developers, SPIFFS (SPI Flash File System) is a popular choice due to its support for wear leveling and file system consistency on SPI NOR flash. The **esp32_spiffsgen** project serves as a comprehensive guide and template for automating the SPIFFS image creation and flashing process.

### Understanding SPIFFS on ESP32

SPIFFS is designed specifically for small flash devices. It is important to note that SPIFFS does not support directories in the traditional sense; instead, it uses a flat structure. If you create a file at `/spiffs/tmp/myfile.txt`, SPIFFS actually creates a file named `/tmp/myfile.txt`. This project helps developers navigate these nuances while providing the tools to manage data efficiently.

### Automated Image Generation with mkspiffs

A core component of this project is the integration of the `mkspiffs` tool. Rather than manually creating images, the project uses a custom `Makefile` to automate the conversion of a local `data/` directory into a flashable `.bin` file. 

To use this tool, the project expects specific parameters based on standard SPI flash characteristics:
- **Block Size**: 4096 bytes
- **Page Size**: 256 bytes
- **Image Size**: Defined by your partition table

The project includes logic to automatically parse the `partitions.csv` file to determine the correct offset and size for the SPIFFS partition, ensuring that the generated image fits perfectly into the allocated flash space.

### Configuration and Partitioning

To successfully deploy a SPIFFS-enabled application, the partition table must be correctly configured. This project provides a sample `partitions.csv` that defines two SPIFFS partitions (`fs_0` and `fs_1`):

```csv
# Name,   Type, SubType, Offset,   Size
nvs,      data, nvs,     0x009000, 0x004000
otadata,  data, ota,     0x00d000, 0x002000
phy_init, data, phy,     0x00f000, 0x001000
ota_0,    app,  ota_0,   0x010000, 0x180000
ota_1,    app,  ota_1,   0x190000, 0x180000
fs_0,     data, spiffs,  0x310000, 0x040000
fs_1,     data, spiffs,  0x350000, 0x040000
```

One critical technical detail highlighted in the documentation is the `Component config` within `menuconfig`. Developers must set the `Size of per-file metadata field` to `0` in the SPIFFS Configuration to ensure compatibility with the images generated by the tool.

### Streamlined Workflow

The project enhances the standard ESP-IDF build system by extending the `flash` target. When you run the flash command, the `Makefile` triggers the following sequence:
1. Compiles the `mkspiffs` utility if it hasn't been built.
2. Packages the contents of the `data/` folder into `spiffs.bin`.
3. Appends the SPIFFS image and its target offset to the `esptool.py` arguments.

This automation reduces the risk of manual errors and significantly speeds up the development cycle when frequently updating static assets on the device. For developers looking to implement robust file storage on the ESP32, this repository provides a solid foundation for both the software implementation and the build-time tooling required for production-ready workflows.
