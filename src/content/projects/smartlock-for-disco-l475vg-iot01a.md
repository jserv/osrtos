---
title: SmartLock for DISCO-L475VG-IOT01A
summary: An Mbed OS-based smart lock application for the DISCO-L475VG-IOT01A board.
  It implements TOTP authentication over Bluetooth Low Energy, Wi-Fi-based RTC synchronization
  via NTP, and secure data persistence using LittleFS.
slug: smartlock-for-disco-l475vg-iot01a
codeUrl: https://github.com/KirillTregubov/SmartLock
star: 5
version: v1.0
lastUpdated: '2022-04-05'
rtos: mbed-os
libraries:
- littlefs
topics:
- cpp
- mbed
- mbed-cli
- mbed-os
- microprocessor
- totp
isShow: false
createdAt: '2026-01-04'
updatedAt: '2026-01-04'
---

The SmartLock project is a sophisticated embedded security application designed for the ST DISCO-L475VG-IOT01A board. Leveraging the Mbed OS ecosystem, it provides a robust mechanism for controlling physical access through a combination of Time-based One-Time Passwords (TOTP) and Bluetooth Low Energy (BLE) communication.

### Secure Authentication with TOTP

At the heart of the system is a TOTP-based validation engine. Upon the first boot, the device generates a unique private key and six recovery keys. To facilitate easy setup, the system generates a QR code that can be scanned by standard mobile authenticator apps. This allows users to generate time-sensitive codes on their smartphones, which are then transmitted to the lock via BLE. The system supports both standard TOTP submission and one-time recovery keys for emergency access.

### Connectivity and Synchronization

The project utilizes both Wi-Fi and Bluetooth capabilities of the IoT Discovery kit. Wi-Fi is primarily used for network time synchronization. Since TOTP relies heavily on accurate timekeeping, the device automatically connects to public NTP servers to sync its internal Real-Time Clock (RTC). This ensures that the codes generated by the mobile app and the device remain in sync, maintaining a Â±30 second validation window.

For user interaction, the device operates as a BLE peripheral. Users connect to the 'SmartLock' service and write the TOTP code as a byte array or UTF string to a specific characteristic. The system then validates the code to grant access, triggering a rising edge on pin D7 for the duration of the unlock.

### Data Persistence and Logging

Security and auditability are handled through a persistent storage layer. Using the LittleFS file system on the board's QSPI Flash, the application stores the private secret, recovery keys, and a detailed log of system events. Users can interact with the physical device to view logs or reset the lock state using the onboard user button. The logging system provides transparency into access attempts and system status.

### Technical Implementation

The project is structured into several modular services:
- **BLE Service**: Manages advertising and GATT characteristic updates for password submission.
- **WiFi Service**: Handles connection to local networks using credentials stored in a dedicated header file.
- **RTC Service**: Manages time synchronization via NTP to ensure TOTP accuracy.
- **Datastore**: Provides an abstraction over the flash memory for secure key and log storage using LittleFS.
- **TOTP Engine**: Implements the SHA1-based password validation logic.

### Getting Started

To build the project, Mbed Studio is recommended. The setup requires deploying dependencies via `mbed deploy` and configuring Wi-Fi credentials in `wifi_credentials.hpp`. Developers should also ensure that the `MBEDTLS_SHA1_C` macro is enabled in the Mbed TLS configuration to support the TOTP hashing requirements. Once flashed, the device will display a QR code on boot, ready to be paired with an authenticator application.
