---
import {getCollection} from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ProjectsList from '../../components/ProjectsList.astro';

const allProjects = await getCollection('projects');

// Filter based on environment: show all in dev, only isShow=true in prod
const filteredProjects = import.meta.env.DEV
  ? allProjects
  : allProjects.filter(project => project.data.isShow === true);

// Sort by createdAt (descending)
const sortedProjects = filteredProjects.sort((a, b) =>
  b.data.createdAt.getTime() - a.data.createdAt.getTime()
);
---

<Layout title="All Open Source Embedded Projects - OSRTOS" description="Browse all open source embedded projects">
  <section class="mb-12 text-center pb-8 border-b border-gray-200 dark:border-gray-700">
    <h1 class="text-2xl font-extrabold mb-4 m-0 text-gray-800 dark:text-gray-100">
      Open Source Embedded Projects
    </h1>
    {import.meta.env.DEV && (
      <p class="text-sm text-orange-600 dark:text-orange-400 m-0">
        Development Mode: Showing all {allProjects.length} projects (including hidden ones)
      </p>
    )}
    {!import.meta.env.DEV && (
      <p class="text-sm text-gray-600 dark:text-gray-400 m-0">
        Showing {sortedProjects.length} projects
      </p>
    )}
  </section>

  <ProjectsList projects={sortedProjects}/>
</Layout>
