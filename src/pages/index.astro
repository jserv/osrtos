---
import {getCollection} from 'astro:content';
import Layout from '../layouts/Layout.astro';
import RtosList from '../components/RtosList.astro';
import LibraryList from '../components/LibraryList.astro';
import ProjectsList from '../components/ProjectsList.astro';

// Fetch and sort RTOS by lastUpdated (descending)
const allRtos = await getCollection('rtos');
const latestRtos = allRtos
  .sort((a, b) => b.data.lastUpdated.valueOf() - a.data.lastUpdated.valueOf())
  .slice(0, 8);

// Fetch and sort Libraries by lastUpdated (descending)
const allLibraries = await getCollection('libraries');
const latestLibraries = allLibraries
  .sort((a, b) => b.data.lastUpdated.valueOf() - a.data.lastUpdated.valueOf())
  .slice(0, 8);

// Fetch featured projects (where isShow = true)
// Sort by createdAt date (descending - newest first)
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter(p => p.data.isShow)
  .sort((a, b) => b.data.createdAt.valueOf() - a.data.createdAt.valueOf())
  .slice(0, 8);
---

<Layout title="OSRTOS - Open Source Real-Time Operating Systems"
        description="Explore the latest open source real-time operating systems and projects">
  <section class="text-center py-12 pb-16 border-b border-gray-200 dark:border-gray-700 mb-12">
    <h1
       class="text-3xl font-extrabold py-1 mb-3 bg-linear-to-r from-purple-400 to-purple-600 bg-clip-text text-transparent">
      Open Source Real-Time Operating Systems
    </h1>
    <p class="text-lg text-gray-500 dark:text-gray-400 mx-auto max-w-3xl">
      Discover the best Open Source RTOS solutions for embedded systems and IoT devices
    </p>
  </section>

  {featuredProjects.length > 0 && (
     <section class="mb-16">
       <div class="flex justify-between items-center mb-8">
         <h2 class="text-3xl md:text-4xl font-bold m-0 text-gray-800 dark:text-gray-100">Featured Projects</h2>
         <a href="/projects/"
            class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 no-underline font-semibold text-base transition-colors">
           View All →
         </a>
       </div>
       <ProjectsList projects={featuredProjects}/>
     </section>
  )}

  <section class="mb-16">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl md:text-4xl font-bold m-0 text-gray-800 dark:text-gray-100">Latest RTOS</h2>
      <a href="/rtos/"
         class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 no-underline font-semibold text-base transition-colors">
        View All →
      </a>
    </div>
    <RtosList rtos={latestRtos}/>
  </section>

  <section class="mb-16">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl md:text-4xl font-bold m-0 text-gray-800 dark:text-gray-100">Latest Libraries</h2>
      <a href="/library/"
         class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 no-underline font-semibold text-base transition-colors">
        View All →
      </a>
    </div>
    <LibraryList libraries={latestLibraries}/>
  </section>


</Layout>
