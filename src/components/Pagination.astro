---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string; // e.g., "/projects/freertos"
}

const { currentPage, totalPages, baseUrl } = Astro.props;

// Generate page numbers to display
const getPageNumbers = () => {
  const pages: (number | string)[] = [];
  const showPages = 5; // Show 5 page numbers at most

  if (totalPages <= showPages) {
    // Show all pages if total is small
    for (let i = 1; i <= totalPages; i++) {
      pages.push(i);
    }
  } else {
    // Always show first page
    pages.push(1);

    if (currentPage > 3) {
      pages.push('...');
    }

    // Show pages around current page
    const start = Math.max(2, currentPage - 1);
    const end = Math.min(totalPages - 1, currentPage + 1);

    for (let i = start; i <= end; i++) {
      pages.push(i);
    }

    if (currentPage < totalPages - 2) {
      pages.push('...');
    }

    // Always show last page
    pages.push(totalPages);
  }

  return pages;
};

const pageNumbers = getPageNumbers();

// Helper to generate page URL
const getPageUrl = (page: number) => {
  if (page === 1) {
    return `${baseUrl}/`;
  }
  return `${baseUrl}/${page}/`;
};

const prevUrl = currentPage > 1 ? getPageUrl(currentPage - 1) : null;
const nextUrl = currentPage < totalPages ? getPageUrl(currentPage + 1) : null;
---

{totalPages > 1 && (
  <nav aria-label="Pagination" class="pagination">
    <ul class="pagination-list">
      {prevUrl && (
        <li>
          <a href={prevUrl} class="pagination-link" aria-label="Previous page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Previous
          </a>
        </li>
      )}

      {pageNumbers.map((page) => (
        typeof page === 'number' ? (
          <li>
            <a
              href={getPageUrl(page)}
              class:list={['pagination-link', { 'is-current': page === currentPage }]}
              aria-label={`Page ${page}`}
              aria-current={page === currentPage ? 'page' : undefined}
            >
              {page}
            </a>
          </li>
        ) : (
          <li>
            <span class="pagination-ellipsis">...</span>
          </li>
        )
      ))}

      {nextUrl && (
        <li>
          <a href={nextUrl} class="pagination-link" aria-label="Next page">
            Next
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
        </li>
      )}
    </ul>
  </nav>
)}

<style>
  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 3rem;
    margin-bottom: 2rem;
  }

  .pagination-list {
    display: flex;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
    flex-wrap: wrap;
    justify-content: center;
  }

  .pagination-link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 0.75rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.375rem;
    text-decoration: none;
    color: #374151;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .pagination-link:hover {
    background-color: #f3f4f6;
    border-color: #d1d5db;
  }

  .pagination-link.is-current {
    background-color: #3b82f6;
    border-color: #3b82f6;
    color: white;
    pointer-events: none;
  }

  .pagination-ellipsis {
    padding: 0.5rem 0.75rem;
    color: #9ca3af;
    font-weight: 500;
  }

  @media (max-width: 640px) {
    .pagination-link {
      padding: 0.4rem 0.6rem;
      font-size: 0.8rem;
    }

    .pagination-list {
      gap: 0.25rem;
    }
  }
</style>
